(()=>{"use strict";class t{constructor(t){this.settings=t}buildBS4AddButton(){const t=this.settings,e=$("<button/>").attr({class:"btn btn-warning"}).html((function(){return!0===t.useIcons?t.iconAddNote:"Add a note"})).trigger("modal").on("click",(function(e){e.preventDefault(),$(t.modalId).modal("show",$(this))}));return $("<div/>").attr({class:"input-group-append"}).append(e)}}class e{constructor(t){this.settings=t}buildBS5AddButton(){const t=this.settings;return $("<button/>").attr({class:"btn btn-warning"}).html((function(){return!0===t.useIcons?t.iconAddNote:"Add a note"})).trigger("modal").on("click",(function(e){e.preventDefault(),$(t.modalId).modal("show",$(this))}))}}class n{constructor(n){this.settings=n,this.bs4=new t(n),this.bs5=new e(n)}buildAddANote(){switch(this.settings.bootstrapVersion){case"4":return this.bs4.buildBS4AddButton();case"5":return this.bs5.buildBS5AddButton()}}buildNotesListing(t){const e=this.settings,o=$(this.settings.recordedNotesContainer);o.empty(),o.addClass("fixed-top").css({top:"5px",right:"5px",width:"200px"});const s=$("<div/>").attr("id","notesListing");for(const o in t){const i=t[o],a=o.replace(/\W/,"");$("<a/>").attr({href:"#"}).addClass("btn btn-block btn-light").html(o).on("click",(function(t){t.preventDefault(),$("#"+a).collapse("toggle")})).appendTo(s);const d=$("<div/>").attr({id:a}).addClass("collapse fade p-2");for(let t in i){const s=$("<div/>").addClass("border-bottom mb-1 p-2").append($("<b/>").html(i[t].id)).append($("<br />")).append(i[t].note).append($("<a/>").attr({href:"#"}).append((function(){return!0===e.useIcons?e.iconRemoveNote:"Delete the note"})).on("click",(function(e){e.preventDefault(),n.prototype.buildConfirmButtonsForRemove({removeAll:!1,currentNoteId:i[t].id.replace(/\W/,""),currentNoteName:o,element:$(this)})})));d.append(s)}s.append(d)}o.append(s);const i=$("<a/>").attr({id:"cleanUpAllNotes",href:"#"}).addClass("btn btn-danger btn-sm btn-block").append((function(){return!0===e.useIcons?e.iconRemoveNote:"Delete all notes"})).on("click",(function(t){t.preventDefault(),n.prototype.buildConfirmButtonsForRemove({removeAll:!0,element:$(this)})}));switch(this.settings.bootstrapVersion){case"4":i.appendTo(o);break;case"5":$("<div/>").addClass("d-grid gap-2").append(i).appendTo(o)}}buildConfirmButtonsForRemove(t){this.settings;const e=$("<div/>").attr({id:"confirmContainer"+t.currentNoteId??""}).addClass("p-1 btn-group btn-group-sm");let n;n=!1===t.removeAll?$("<a/>").attr({href:"#"}).addClass("btn btn-success").html("Remove?").on("click",(function(e){e.preventDefault();const n={};n.name=t.currentNoteName,n.id=t.currentNoteId,$.notesBS.removeNotes(n)})):$("<a/>").attr({href:"#"}).addClass("btn btn-success").html("Remove all notes?").on("click",(function(t){t.preventDefault(),$.notesBS.clearNotes()}));const o=$("<a/>").attr({href:"#"}).html("Cancel").addClass("btn btn-sm btn-danger").on("click",(function(e){e.preventDefault(),$("#confirmContainer"+t.currentNoteId??"").remove()}));e.append(n,o),e.insertAfter(t.element)}buildStickyNoteContainer(t){const e=this.settings,n=$("<div/>").attr({id:t}).css({position:"fixed","z-index":"999",top:"50px",right:"5px",width:"230px",rotate:"-5deg",background:"#ff0000"}).addClass("d-none").append($("<div/>").addClass("d-flex justify-content-between").append($("<a/>").attr("href","#").addClass("btn btn-sm btn-close").html("X").on("click",(function(e){e.preventDefault(),$("#"+t).addClass("d-none")}))).append($("<div/>").attr("id","currentNoteContent").addClass("p-2")).append($("<div/>").append($(e.stickyNotePushPinIcon).css({"font-size":"4em",rotate:"15deg",position:"fixed",top:"-35px",right:"25px"}))));$(document.body).append(n)}buildExistingNote(t){const e=this.settings;return $("<div/>").attr({class:"alert alert-warning my-2 existingNoteContainer",id:"noteFor"+t.id}).append((function(){return!0===e.useIcons?e.iconExistingNote:"Recorded note: "})).append($("<b/>").html(t.note))}buildInputGroup(t){const e=$("<div/>").attr({class:"input-group"}).append(t);return $(t).on("blur",(function(){const t=$(this).val();$.notesBS.checkIfIdExist({id:t,ele:$(this)})})),e.append(this.buildAddANote())}}!function(t){const e={key:"BS4_notes",expireAfter:168,convertClass:"haveNote",useIcons:!0,modalId:"#addNoteModal",iconAddNote:'<span class="material-symbols-outlined fs">note_add</span>',iconExistingNote:'<span class="material-symbols-outlined fs">note</span>',iconRemoveNote:'<span class="material-symbols-outlined fs">delete</span>',recordedNotesContainer:"#notesContainer",bootstrapVersion:"4",stickyNoteId:"",stickyNotePushPinIcon:'<span class="material-symbols-rounded fs">push_pin</span>'};let o,s={},i={};t.notesBS=a=>{s=Object.assign({},e,a),o=new n(s),s.stickyNoteId&&o.buildStickyNoteContainer(s.stickyNoteId),i=t.notesBS.readNotes(s.key),t.notesBS.buildNotes(),t.notesBS.doNotesInit(),t(s.modalId).on("shown.bs.modal",(function(e){const n=t(this).find("form"),o=t(this).find("button[type=submit]");n.trigger("reset");const i=e.relatedTarget,a=t(i).parents(".input-group").find("."+s.convertClass);t("#noteTitle").val(a.val()),t("#noteName").val(a.data("note-title")??a.attr("name")),t("#noteContent").focus(),o.on("click",(function(e){t.notesBS.submitNewNote(e,n)}))}))},t.notesBS.submitNewNote=(e,n)=>{if(!1===n[0].checkValidity())e.preventDefault(),e.stopPropagation(),n.addClass("was-validated");else{const e={},n=t("#noteTitle"),o=t("#noteContent");e.id=n.val(),e.note=o.val(),e.name=t("#noteName").val(),e.key=s.key,t.notesBS.saveNotes(e),t(s.modalId).modal("hide"),t.notesBS.buildNotes()}},t.notesBS.doNotesInit=()=>{const e=t("."+s.convertClass);t.each(e,(function(e,n){if(t(n).parent(".input-group").length>0)t(n).parents(".input-group").append(o.buildAddANote()),t(n).on("blur",(function(){const e=t(this).val();t.notesBS.checkIfIdExist({id:e,ele:t(this)})}));else{const e=t(n).clone();t(n).replaceWith(o.buildInputGroup(e))}}))},t.notesBS.buildNotes=()=>{const e=t(s.recordedNotesContainer);Object.keys(i).length>0?(e.removeClass("d-none"),o.buildNotesListing(i)):e.addClass("d-none")},t.notesBS.checkIfIdExist=e=>{const n=e.ele.data("note-title")??e.ele.attr("name");if(t.notesBS.removeDisplayedNote(e),void 0!==i[n]){const a=i[n].find((t=>t.id===e.id));if(void 0!==a)if(""!==s.stickyNoteId){const e=t("#"+s.stickyNoteId);e.length>0&&(e.hasClass("d-none")&&e.removeClass("d-none"),t("#currentNoteContent").html(o.buildExistingNote(a)))}else e.ele.parent(".input-group").after(o.buildExistingNote(a))}},t.notesBS.removeDisplayedNote=e=>{if(""!==s.stickyNoteId){const e=t("#"+s.stickyNoteId);if(e.length>0){e.find(".existingNoteContainer");e.hasClass("d-none")||e.addClass("d-none")}}else{const t=e.ele.parent(".input-group").next(".existingNoteContainer");t.length>0&&t.remove()}},t.notesBS.readNotes=e=>{i=JSON.parse(localStorage.getItem(e))??{};const n=(new Date).getTime();for(const e in i)for(const o in i[e]){const s=i[e][o];n>s.ttl&&t.notesBS.removeNotes({name:e,id:s.id})}return i},t.notesBS.saveNotes=e=>{let n={};const o=(new Date).getTime()+60*s.expireAfter*60*1e3;localStorage.getItem(e.key)?(n=JSON.parse(localStorage.getItem(e.key)),void 0===n[e.name]&&(n[e.name]=[])):n[e.name]=[];void 0===n[e.name].find((t=>t.id===e.id))&&(n[e.name.trim()].push({id:e.id.trim(),note:e.note.trim(),ttl:o}),localStorage.setItem(e.key,JSON.stringify(n))),t.notesBS.readNotes(s.key)},t.notesBS.removeNotes=e=>{let n={};if(localStorage.getItem(s.key)){if(n=JSON.parse(localStorage.getItem(s.key)),void 0!==n[e.name]){const t=n[e.name].find((t=>t.id.trim()===e.id.trim()));for(const o in n[e.name])n[e.name][o]===t&&n[e.name].splice(parseInt(o),1);n[e.name].length<1&&delete n[e.name]}localStorage.setItem(s.key,JSON.stringify(n))}t.notesBS.readNotes(s.key),t.notesBS.buildNotes()},t.notesBS.clearNotes=()=>{localStorage.removeItem(s.key),t(".existingNoteContainer").remove(),i={},t.notesBS.buildNotes()}}(jQuery)})();