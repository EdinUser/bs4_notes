<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 48
        }

        #notesContainer {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 150px;
        }
    </style>
</head>
<body>
<div class="container">

    <div id="testVanilla">

    </div>
    <div class="d-none" id="notesContainer">
        <div id="notesListing">

        </div>
        <a href="#" class="btn btn-danger btn-sm btn-block" id="cleanUpAllNotes">
            <span class="material-symbols-outlined fs">
                delete
            </span>
        </a>
    </div>

    <div class="card">
        <div class="card-header card-header-gray">
            <h2 class="card-title">
            </h2>
        </div>
        <div class="card-body">


            <div class="input-group">
                <input type="text" class="form-control haveNote"/>
                <div class="input-group-append">
                    <button type="button" class="btn btn-warning" id="addNote" data-toggle="modal" data-target="#addNoteModal">
                        <span class="material-symbols-outlined fs">
                            add
                        </span>
                    </button>
                </div>
            </div>
            <div id="string2"></div>
        </div>
        <div class="card-footer">

        </div>
    </div>
</div>
<script>
    // this can be replaced by an URL parser
    const key = 'test';
    $(function () {
        buildNotes(key)
        $("#addNoteModal").on("shown.bs.modal", function (e) {
            const triggered = e.relatedTarget;
            const noteTitle = $(triggered).parents(".input-group").find(".haveNote").val();
            $("#noteTitle").val(noteTitle);
        });

        $("#addNoteForm").on("submit", function (e) {
            e.preventDefault();
            const dataForSave = {};
            dataForSave.id = $("#noteTitle").val()
            dataForSave.note = $("#noteContent").val()
            dataForSave.key = key
            saveNotes(dataForSave)
            $("#addNoteModal").modal('hide');
            buildNotes(key)
        })
        $("#cleanUpAllNotes").on("click", function (e) {
            e.preventDefault();
            clearNotes(key)
        })
    })

    function buildNotes(key) {
        const existingNotes = readNotes(key);
        const notesContainer = $("#notesContainer");
        const notesListing = $("#notesListing");
        const testVanilla = document.getElementById("testVanilla")

        notesListing.empty();

        if (Object.keys(existingNotes).length > 0) {
            notesContainer.removeClass("d-none");
            for (const note in existingNotes) {
                const currentNote = existingNotes[note];
                checkIfIdExist({id: "#" + note, note: currentNote})

                const newLinkElement = document.createElement("a");
                newLinkElement.innerText = note;
                newLinkElement.href = "#";
                newLinkElement.className = "btn btn-light btn-block";
                newLinkElement.setAttribute('data-toggle', 'collapse');
                newLinkElement.setAttribute('data-target', "#" + note);
                testVanilla.appendChild(newLinkElement)

                $("<a/>")
                    .attr({
                        href: "#"
                    })
                    .addClass("btn btn-block btn-light")
                    .html(note)
                    .on("click", function (e) {
                        e.preventDefault();
                        $("#" + note).collapse("toggle")
                    })
                    .appendTo(notesListing);
                $("<div/>")
                    .attr({
                        id: note
                    })
                    .addClass("collapse fade p-2")
                    .html(currentNote).appendTo(notesListing);
            }
        } else {
            notesContainer.addClass("d-none");
        }

    }

    function checkIfIdExist(data) {
        if ($(data.id).length > 0) {
            $(data.id).after(
                $("<span/>").addClass("material-symbols-outlined fs text-danger").html("description").attr({
                    title: data.note
                })
            )
        }
    }

    function readNotes(key) {
        return JSON.parse(localStorage.getItem(key)) ?? {};
    }

    function saveNotes(data) {
        let storageData = {}
        if (localStorage.getItem(data.key)) {
            storageData = JSON.parse(localStorage.getItem(data.key));
        }
        storageData[data.id] = data.note;

        localStorage.removeItem(data.key);
        localStorage.setItem(data.key, JSON.stringify(storageData))
    }

    function clearNotes(key) {
        localStorage.removeItem(key);
        buildNotes(key)
    }
</script>
<div class="modal fade" id="addNoteModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add a note</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" action="/" id="addNoteForm">
                <div class="modal-body">
                    <label for="noteTitle">Note title</label>
                    <input type="text" name="noteTitle" class="form-control" id="noteTitle" required/>
                    <label for="noteContent">Note</label>
                    <input type="text" name="noteContent" class="form-control" id="noteContent" required/>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" id="saveNote">Save note</button>
                </div>
            </form>
        </div>
    </div>
</div>
</body>
</html>